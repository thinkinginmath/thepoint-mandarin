<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script>
var mapping = `创	Ge
出	Ex
利	Le
民	Nu
申	De
书	Jos
士	Ju
得	Ru
撒上	1 S
撒下	2 S
王上	1 K
王下	2 K
代上	1 Chr
代下	2 Chr
拉	Ezr
尼	Ne
斯	Est
伯	Job
诗	Ps
箴	Pr
传	Ec
歌	Song
赛	Is
耶	Je
哀	La
结	Ez
但	Da
何	Ho
珥	Joel
摩	Am
俄	Obad
拿	Jona
弥	Mi
鸿	Na
哈	Ha
番	Zeph
该	Hagg
亚	Zech
玛	Ma
太	Mt
可	Mak
路	Lk
约	Jn
徒	Acts
罗	Ro
林前	1 Co
林后	2 Co
加	Ga
弗	Ep
腓	Phl
西	Co
帖前	1 Th
帖后	2 Th
提前	1 Ti
提后	2 Ti
多	Tit
门	Phm
来	He
雅	Ja
彼前 1 Pe
彼后 2 Pe
约一 1 Jhn
约二 2 Jhn
约三 3 Jhn
犹 Jude
启 Re`;

var list_txt = mapping.split("\n");
var MAP_BOOKNAMES = {};
for (var i = 0; i < list_txt.length; i++) {
    var txt = list_txt[i];
    var name_val = txt.split(/\s+/);
    MAP_BOOKNAMES[name_val[0]] = name_val.slice(1).join(" ");
    //console.log(name_val[0], name_val[1]);
}
</script>
  </head>

  <body>

<div class="container">
  <h1>经文查询</h1>

  <form id="target">
    <div class="form-group">
      <label for="exampleInputEmail1">书名 及章节， 如： 诗 95:1-3 </label>
      <input type="text" name="book" class="form-control" id="book" aria-describedby="emailHelp" placeholder="诗 95:1-3">
      <small id="emailHelp" class="form-text text-muted">只能输入一个书名及章， 多节用逗号(只接受英文模式字符)分隔，诗 95:1-3,5-10</small>
    </div>
    <button type="submit" class="btn btn-primary">Submit</button>
  </form>

</div>
<div class="container" id="result">
</div>
<script>
$("#target").submit(function( event ) {
  var book = $("input[name=book]").val();
  $('#result').text (book);
  event.preventDefault();

  // Frind the first whitespace
  var pos = book.indexOf(' ');
  var bookName = book.substring(0, pos);
  var param = book.substring(pos);
  var bookNameEng = MAP_BOOKNAMES[bookName];
  jQuery.ajax({
      url:'https://getbible.net/json',
      dataType: 'jsonp',
      data: 'v=cut&p=' + bookNameEng + param,
      jsonp: 'getbible',
      success: function(json){
          // set text direction
          // check response type
          if (json.type == 'verse'){
              var output = '';
              	jQuery.each(json.book, function(index, value) {
                  	output += '<center><b>'+value.book_name+' '+value.chapter_nr+'</b></center><br/><p>';
                      jQuery.each(value.chapter, function(index, value) {
                          output += '  <small class="ltr">' +value.verse_nr+ '</small>  ';
                          output += value.verse;
                          output += '<br/>';
                      });
                      output += '</p>';
              	});
              jQuery('#result').html(output);  // <---- this is the div id we update
          } else if (json.type == 'chapter'){
              var output = '<center><b>'+json.book_name+' '+json.chapter_nr+'</b></center><br/><p>';
              jQuery.each(json.chapter, function(index, value) {
                  output += '  <small class="ltr">' +value.verse_nr+ '</small>  ';
                  output += value.verse;
                  output += '<br/>';
              });
              output += '</p>';
              jQuery('#result').html(output);  // <---- this is the div id we update
          } else if (json.type == 'book'){
              var output = '';
              jQuery.each(json.book, function(index, value) {
                  output += '<center><b>'+json.book_name+' '+value.chapter_nr+'</b></center><br/><p>';
                  jQuery.each(value.chapter, function(index, value) {
                      output += '  <small class="ltr">' +value.verse_nr+ '</small>  ';
                      output += value.verse;
                      output += '<br/>';
                  });
              output += '</p>';
          });
          if(addTo){
          	jQuery('#result').html(output);  // <---- this is the div id we update
          }
        }
      },
      error:function(){
          jQuery('#result').html('<h2>No scripture was returned, please try again!</h2>'); // <---- this is the div id we update
       },
  });









});
</script>

</body>
</html>
